DROP ALL OBJECTS;

CREATE TABLE IF NOT EXISTS USERS
(
    USER_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_EMAIL CHARACTER VARYING(255) NOT NULL,
    USER_LOGIN CHARACTER VARYING(255) NOT NULL,
    USER_NAME CHARACTER VARYING(255),
    USER_BIRTHDAY DATE
);
CREATE TABLE IF NOT EXISTS MPA
(
    MPA_ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MPA_NAME VARCHAR(25) NOT NULL
);
CREATE TABLE IF NOT EXISTS FILMS
(
    FILM_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FILM_NAME CHARACTER VARYING(255) NOT NULL,
    FILM_DESCRIPTION CHARACTER VARYING(255) NOT NULL,
    FILM_RELEASE_DATE DATE NOT NULL,
    FILM_DURATION INTEGER NOT NULL,
    MPA_ID INTEGER NOT NULL NOT NULL REFERENCES MPA (MPA_ID)
);
CREATE TABLE IF NOT EXISTS GENRES
(
    GENRE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    GENRE_NAME CHARACTER VARYING(100) NOT NULL
);
CREATE TABLE IF NOT EXISTS FRIENDS
(
    ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    FRIEND_ID INTEGER NOT NULL  REFERENCES USERS(USER_ID) ON DELETE CASCADE
);
CREATE TABLE IF NOT EXISTS FILM_GENRES
(
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,
    FILM_ID INTEGER NOT NULL REFERENCES FILMS (FILM_ID) ON DELETE CASCADE,
    GENRE_ID INTEGER NOT NULL REFERENCES GENRES (GENRE_ID)
);
CREATE TABLE IF NOT EXISTS LIKES
(
    ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    FILM_ID INTEGER NOT NULL REFERENCES FILMS(FILM_ID) ON DELETE CASCADE,
    USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE
);
CREATE TABLE IF NOT EXISTS reviews
(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  CONTENT VARCHAR(500) NOT NULL,
  IS_POSITIVE BOOLEAN,
  FILM_ID INTEGER NOT NULL REFERENCES FILMS(FILM_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON UPDATE CASCADE ON DELETE CASCADE,
  USEFUL INTEGER
);
CREATE TABLE IF NOT EXISTS EVENTS
(
  EVENT_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  EVENT_TYPE VARCHAR(30) NOT NULL,
  OPERATION_TYPE VARCHAR(30) NOT NULL,
  ENTITY_ID INTEGER NOT NULL,
  USER_ID INTEGER NOT NULL REFERENCES USERS(USER_ID) ON DELETE CASCADE,
  EVENT_TIME BIGINT NOT NULL
);